<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gi·∫£i m√£ & M√£ h√≥a Save File</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 20px auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            margin: 10px 0;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #007bff;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            font-weight: 600;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        button.success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }
        button.danger {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        }
        button.warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .error {
            color: #dc3545;
            padding: 15px;
            background: #ffe6e6;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #dc3545;
        }
        .success {
            color: #28a745;
            padding: 15px;
            background: #e6ffe6;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #28a745;
        }
        .warning {
            color: #ffc107;
            padding: 15px;
            background: #fff9e6;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ffc107;
        }
        h1 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #333;
            font-size: 18px;
            margin-bottom: 10px;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 6px 6px 0 0;
            background: #e9ecef;
            transition: all 0.3s;
        }
        .tab.active {
            background: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            padding: 15px;
            background: white;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            font-size: 12px;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê C√¥ng c·ª• Gi·∫£i m√£ & M√£ h√≥a Save File</h1>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('decode')">üîì Gi·∫£i m√£</div>
            <div class="tab" onclick="switchTab('encode')">üîí M√£ h√≥a</div>
            <div class="tab" onclick="switchTab('edit')">‚úèÔ∏è Ch·ªânh s·ª≠a</div>
        </div>

        <!-- TAB GI·∫¢I M√É -->
        <div id="decodeTab" class="tab-content active">
            <div class="section">
                <h2>üì• D·ªØ li·ªáu ƒë√£ m√£ h√≥a:</h2>
                <textarea id="encoded" placeholder="D√°n d·ªØ li·ªáu LZ-String Base64 v√†o ƒë√¢y ho·∫∑c click 'T·∫£i t·ª´ save.md'..."></textarea>
                
                <div class="button-group">
                    <button onclick="loadFromFile()">üìÇ T·∫£i t·ª´ save.md</button>
                    <button onclick="decodeLZStringBase64()" class="success">üîì Gi·∫£i m√£ LZ-String Base64</button>
                    <button onclick="clearAll()" class="danger">üóëÔ∏è X√≥a t·∫•t c·∫£</button>
                </div>
            </div>

            <div id="message"></div>
            
            <div class="section">
                <h2>üì§ K·∫øt qu·∫£ gi·∫£i m√£:</h2>
                <textarea id="decoded" placeholder="K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..." readonly></textarea>
                
                <div class="stats" id="decodeStats" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="decodedLength">0</div>
                        <div class="stat-label">K√Ω t·ª±</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="decodedLines">0</div>
                        <div class="stat-label">D√≤ng</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="compressionRatio">0%</div>
                        <div class="stat-label">T·ª∑ l·ªá n√©n</div>
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="copyDecoded()">üìã Copy</button>
                    <button onclick="downloadDecoded()">üíæ T·∫£i xu·ªëng</button>
                    <button onclick="formatJSON()">üìê Format JSON</button>
                    <button onclick="moveToEdit()" class="warning">‚úèÔ∏è Chuy·ªÉn sang ch·ªânh s·ª≠a</button>
                </div>
            </div>
        </div>

        <!-- TAB M√É H√ìA -->
        <div id="encodeTab" class="tab-content">
            <div class="section">
                <h2>üìù D·ªØ li·ªáu g·ªëc (c·∫ßn m√£ h√≥a):</h2>
                <textarea id="toEncode" placeholder="Nh·∫≠p ho·∫∑c d√°n d·ªØ li·ªáu c·∫ßn m√£ h√≥a v√†o ƒë√¢y..."></textarea>
                
                <div class="button-group">
                    <button onclick="encodeLZStringBase64()" class="success">üîí M√£ h√≥a LZ-String Base64</button>
                    <button onclick="clearEncode()" class="danger">üóëÔ∏è X√≥a</button>
                </div>
            </div>

            <div id="encodeMessage"></div>

            <div class="section">
                <h2>üîê K·∫øt qu·∫£ m√£ h√≥a:</h2>
                <textarea id="encodedResult" placeholder="K·∫øt qu·∫£ m√£ h√≥a s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y..." readonly></textarea>
                
                <div class="stats" id="encodeStats" style="display: none;">
                    <div class="stat-box">
                        <div class="stat-value" id="encodedLength">0</div>
                        <div class="stat-label">K√Ω t·ª± sau m√£ h√≥a</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="originalLength">0</div>
                        <div class="stat-label">K√Ω t·ª± g·ªëc</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-value" id="encodeCompressionRatio">0%</div>
                        <div class="stat-label">T·ª∑ l·ªá n√©n</div>
                    </div>
                </div>

                <div class="button-group">
                    <button onclick="copyEncoded()">üìã Copy k·∫øt qu·∫£</button>
                    <button onclick="downloadEncoded()">üíæ T·∫£i xu·ªëng save.md</button>
                    <button onclick="saveToBrowser()" class="warning">üíø L∆∞u v√†o localStorage</button>
                </div>
            </div>
        </div>

        <!-- TAB CH·ªàNH S·ª¨A -->
        <div id="editTab" class="tab-content">
            <div class="section">
                <h2>‚úèÔ∏è Ch·ªânh s·ª≠a d·ªØ li·ªáu:</h2>
                <p style="color: #6c757d; font-size: 14px;">Quy tr√¨nh: Gi·∫£i m√£ ‚Üí Ch·ªânh s·ª≠a ‚Üí M√£ h√≥a l·∫°i</p>
                
                <div class="button-group">
                    <button onclick="loadAndDecode()" class="success">üìÇ 1. T·∫£i & Gi·∫£i m√£ save.md</button>
                </div>

                <textarea id="editArea" placeholder="D·ªØ li·ªáu ƒë√£ gi·∫£i m√£ s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y ƒë·ªÉ ch·ªânh s·ª≠a..."></textarea>
                
                <div class="button-group">
                    <button onclick="formatJSONInEdit()">üìê Format JSON</button>
                    <button onclick="validateJSON()">‚úÖ Ki·ªÉm tra JSON</button>
                    <button onclick="encodeAndSave()" class="success">üîí 2. M√£ h√≥a & L∆∞u</button>
                </div>
            </div>

            <div id="editMessage"></div>

            <div class="section" id="encodedPreview" style="display: none;">
                <h2>üëÅÔ∏è Preview m√£ h√≥a:</h2>
                <textarea id="encodedPreviewArea" readonly></textarea>
                <div class="button-group">
                    <button onclick="downloadEncodedFromEdit()">üíæ T·∫£i xu·ªëng save.md m·ªõi</button>
                    <button onclick="copyEncodedFromEdit()">üìã Copy</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // T·ª± ƒë·ªông load d·ªØ li·ªáu t·ª´ save.md khi trang ƒë∆∞·ª£c t·∫£i
        window.onload = function() {
            // Kh√¥ng t·ª± ƒë·ªông load n·ªØa, ƒë·ªÉ user t·ª± ch·ªçn
        };

        function switchTab(tabName) {
            // ·∫®n t·∫•t c·∫£ tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
            if (tabName === 'decode') {
                document.getElementById('decodeTab').classList.add('active');
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tabName === 'encode') {
                document.getElementById('encodeTab').classList.add('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            } else if (tabName === 'edit') {
                document.getElementById('editTab').classList.add('active');
                document.querySelectorAll('.tab')[2].classList.add('active');
            }
        }

        // ========== TAB GI·∫¢I M√É ==========
        function loadFromFile() {
            fetch('save.md')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('encoded').value = data;
                    showMessage('‚úÖ ƒê√£ t·∫£i d·ªØ li·ªáu t·ª´ save.md', 'success');
                })
                .catch(error => {
                    showMessage('‚ùå L·ªói khi t·∫£i file: ' + error.message, 'error');
                });
        }

        function decodeLZStringBase64() {
            try {
                const encoded = document.getElementById('encoded').value.trim();
                if (!encoded) {
                    showMessage('‚ö†Ô∏è Vui l√≤ng nh·∫≠p ho·∫∑c t·∫£i d·ªØ li·ªáu c·∫ßn gi·∫£i m√£', 'warning');
                    return;
                }

                const decoded = LZString.decompressFromBase64(encoded);
                if (decoded) {
                    document.getElementById('decoded').value = decoded;
                    
                    // Hi·ªÉn th·ªã th·ªëng k√™
                    document.getElementById('decodeStats').style.display = 'grid';
                    document.getElementById('decodedLength').textContent = decoded.length.toLocaleString();
                    document.getElementById('decodedLines').textContent = decoded.split('\n').length.toLocaleString();
                    const ratio = ((1 - encoded.length / decoded.length) * 100).toFixed(1);
                    document.getElementById('compressionRatio').textContent = ratio + '%';
                    
                    showMessage('‚úÖ Gi·∫£i m√£ LZ-String Base64 th√†nh c√¥ng!', 'success');
                } else {
                    showMessage('‚ùå Kh√¥ng th·ªÉ gi·∫£i m√£. D·ªØ li·ªáu c√≥ th·ªÉ kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng LZ-String Base64', 'error');
                }
            } catch (e) {
                showMessage('‚ùå L·ªói LZ-String Base64: ' + e.message, 'error');
            }
        }

        function clearAll() {
            document.getElementById('encoded').value = '';
            document.getElementById('decoded').value = '';
            document.getElementById('message').innerHTML = '';
            document.getElementById('decodeStats').style.display = 'none';
        }

        function copyDecoded() {
            const result = document.getElementById('decoded').value;
            if (!result) {
                showMessage('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ copy', 'warning');
                return;
            }
            navigator.clipboard.writeText(result).then(() => {
                showMessage('‚úÖ ƒê√£ copy v√†o clipboard!', 'success');
            });
        }

        function downloadDecoded() {
            const result = document.getElementById('decoded').value;
            if (!result) {
                showMessage('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i xu·ªëng', 'warning');
                return;
            }
            const blob = new Blob([result], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'decoded_save.txt';
            a.click();
            URL.revokeObjectURL(url);
            showMessage('‚úÖ ƒê√£ t·∫£i xu·ªëng file decoded_save.txt!', 'success');
        }

        function formatJSON() {
            try {
                const result = document.getElementById('decoded').value;
                const json = JSON.parse(result);
                const formatted = JSON.stringify(json, null, 2);
                document.getElementById('decoded').value = formatted;
                showMessage('‚úÖ ƒê√£ format JSON!', 'success');
            } catch (e) {
                showMessage('‚ùå D·ªØ li·ªáu kh√¥ng ph·∫£i JSON h·ª£p l·ªá: ' + e.message, 'error');
            }
        }

        function moveToEdit() {
            const decoded = document.getElementById('decoded').value;
            if (!decoded) {
                showMessage('‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√£ gi·∫£i m√£', 'warning');
                return;
            }
            document.getElementById('editArea').value = decoded;
            switchTab('edit');
            showMessageInEdit('‚úÖ ƒê√£ chuy·ªÉn d·ªØ li·ªáu sang tab ch·ªânh s·ª≠a', 'success');
        }

        // ========== TAB M√É H√ìA ==========
        function encodeLZStringBase64() {
            try {
                const plainText = document.getElementById('toEncode').value;
                if (!plainText) {
                    showMessageInEncode('‚ö†Ô∏è Vui l√≤ng nh·∫≠p d·ªØ li·ªáu c·∫ßn m√£ h√≥a', 'warning');
                    return;
                }

                const encoded = LZString.compressToBase64(plainText);
                document.getElementById('encodedResult').value = encoded;
                
                // Hi·ªÉn th·ªã th·ªëng k√™
                document.getElementById('encodeStats').style.display = 'grid';
                document.getElementById('encodedLength').textContent = encoded.length.toLocaleString();
                document.getElementById('originalLength').textContent = plainText.length.toLocaleString();
                const ratio = ((1 - encoded.length / plainText.length) * 100).toFixed(1);
                document.getElementById('encodeCompressionRatio').textContent = ratio + '%';
                
                showMessageInEncode('‚úÖ M√£ h√≥a LZ-String Base64 th√†nh c√¥ng!', 'success');
            } catch (e) {
                showMessageInEncode('‚ùå L·ªói m√£ h√≥a: ' + e.message, 'error');
            }
        }

        function clearEncode() {
            document.getElementById('toEncode').value = '';
            document.getElementById('encodedResult').value = '';
            document.getElementById('encodeMessage').innerHTML = '';
            document.getElementById('encodeStats').style.display = 'none';
        }

        function copyEncoded() {
            const result = document.getElementById('encodedResult').value;
            if (!result) {
                showMessageInEncode('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ copy', 'warning');
                return;
            }
            navigator.clipboard.writeText(result).then(() => {
                showMessageInEncode('‚úÖ ƒê√£ copy v√†o clipboard!', 'success');
            });
        }

        function downloadEncoded() {
            const result = document.getElementById('encodedResult').value;
            if (!result) {
                showMessageInEncode('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i xu·ªëng', 'warning');
                return;
            }
            const blob = new Blob([result], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'save.md';
            a.click();
            URL.revokeObjectURL(url);
            showMessageInEncode('‚úÖ ƒê√£ t·∫£i xu·ªëng file save.md!', 'success');
        }

        function saveToBrowser() {
            const result = document.getElementById('encodedResult').value;
            if (!result) {
                showMessageInEncode('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ l∆∞u', 'warning');
                return;
            }
            localStorage.setItem('saved_game', result);
            showMessageInEncode('‚úÖ ƒê√£ l∆∞u v√†o localStorage c·ªßa tr√¨nh duy·ªát!', 'success');
        }

        // ========== TAB CH·ªàNH S·ª¨A ==========
        function loadAndDecode() {
            fetch('save.md')
                .then(response => response.text())
                .then(data => {
                    const decoded = LZString.decompressFromBase64(data);
                    if (decoded) {
                        document.getElementById('editArea').value = decoded;
                        showMessageInEdit('‚úÖ ƒê√£ t·∫£i v√† gi·∫£i m√£ save.md th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a b√™n d∆∞·ªõi.', 'success');
                    } else {
                        showMessageInEdit('‚ùå Kh√¥ng th·ªÉ gi·∫£i m√£ file save.md', 'error');
                    }
                })
                .catch(error => {
                    showMessageInEdit('‚ùå L·ªói khi t·∫£i file: ' + error.message, 'error');
                });
        }

        function formatJSONInEdit() {
            try {
                const content = document.getElementById('editArea').value;
                const json = JSON.parse(content);
                const formatted = JSON.stringify(json, null, 2);
                document.getElementById('editArea').value = formatted;
                showMessageInEdit('‚úÖ ƒê√£ format JSON!', 'success');
            } catch (e) {
                showMessageInEdit('‚ùå D·ªØ li·ªáu kh√¥ng ph·∫£i JSON h·ª£p l·ªá: ' + e.message, 'error');
            }
        }

        function validateJSON() {
            try {
                const content = document.getElementById('editArea').value;
                JSON.parse(content);
                showMessageInEdit('‚úÖ JSON h·ª£p l·ªá! B·∫°n c√≥ th·ªÉ m√£ h√≥a v√† l∆∞u.', 'success');
            } catch (e) {
                showMessageInEdit('‚ùå JSON kh√¥ng h·ª£p l·ªá: ' + e.message, 'error');
            }
        }

        function encodeAndSave() {
            try {
                const content = document.getElementById('editArea').value;
                if (!content) {
                    showMessageInEdit('‚ö†Ô∏è Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ m√£ h√≥a', 'warning');
                    return;
                }

                const encoded = LZString.compressToBase64(content);
                document.getElementById('encodedPreviewArea').value = encoded;
                document.getElementById('encodedPreview').style.display = 'block';
                
                showMessageInEdit('‚úÖ ƒê√£ m√£ h√≥a th√†nh c√¥ng! Xem preview b√™n d∆∞·ªõi v√† t·∫£i xu·ªëng.', 'success');
            } catch (e) {
                showMessageInEdit('‚ùå L·ªói m√£ h√≥a: ' + e.message, 'error');
            }
        }

        function downloadEncodedFromEdit() {
            const result = document.getElementById('encodedPreviewArea').value;
            if (!result) {
                showMessageInEdit('‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√£ m√£ h√≥a', 'warning');
                return;
            }
            const blob = new Blob([result], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'save.md';
            a.click();
            URL.revokeObjectURL(url);
            showMessageInEdit('‚úÖ ƒê√£ t·∫£i xu·ªëng file save.md m·ªõi!', 'success');
        }

        function copyEncodedFromEdit() {
            const result = document.getElementById('encodedPreviewArea').value;
            if (!result) {
                showMessageInEdit('‚ö†Ô∏è Ch∆∞a c√≥ d·ªØ li·ªáu ƒë√£ m√£ h√≥a', 'warning');
                return;
            }
            navigator.clipboard.writeText(result).then(() => {
                showMessageInEdit('‚úÖ ƒê√£ copy v√†o clipboard!', 'success');
            });
        }

        // ========== H√ÄM HI·ªÇN TH·ªä TH√îNG B√ÅO ==========
        function showMessage(msg, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.innerHTML = `<div class="${type}">${msg}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function showMessageInEncode(msg, type) {
            const messageDiv = document.getElementById('encodeMessage');
            messageDiv.innerHTML = `<div class="${type}">${msg}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }

        function showMessageInEdit(msg, type) {
            const messageDiv = document.getElementById('editMessage');
            messageDiv.innerHTML = `<div class="${type}">${msg}</div>`;
            setTimeout(() => {
                messageDiv.innerHTML = '';
            }, 5000);
        }
    </script>
</body>
</html>
